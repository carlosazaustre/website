---
title: "Automatizar tareas en JavaScript con Grunt.js"
date: "2013-08-01"
tags:
  - "üíª Desarrollo"
---

[Grunt.js](http://gruntjs.com/) es una librer√≠a JavaScript que nos permite configurar tareas autom√°ticas y as√≠ ahorrarnos tiempo en nuestro desarrollo y despliegue de aplicaciones webs.

Con un simple fichero JS que llamaremos `Gruntfile`, indicamos las tareas que queremos automatizar con un simple comando y las escribimos en √©l en formato JSON.

![Automatizaci√≥n de tareas con Grunt JS](/images/automatizar-tareas-en-javascript-con-grunt-js/grunt-logo_g3kshp.png)

A continuaci√≥n muestro como ser√≠a este fichero para automatizar las tareas de arranque del servidor y preprocesamiento de archivos stylus a CSS y su minificaci√≥n.

Lo primero que necesitamos es instalar Grunt de manera global en nuestro equipo, doy por hecho que ya tenemos Node.js instalado, si no es as√≠ p√°sate por esta entrada.

Para ello tecleamos:

```shell
$ sudo npm install -g grunt
$ sudo npm install -g grunt-cli
```

Grunt posee diversos plugins para tareas espec√≠ficas, nosotros usaremos `grunt-contrib-watch`, `grunt-contrib-stylus`,¬†`grunt-contrib-cssmin` y `grunt-contrib-bg-shell`. Estas librer√≠as nos permitir√°n vigilar cambiso que hagamos en determinados directorios para as√≠ actuar y ejecutar la tarea que queremos, preprocesar stylus y convertirlo a CSS, minificar el CSS y ejecutar instrucciones por linea de comandos respectivamente.

Para cargar los plugins, debemos incluir en nuestro fichero `Gruntfile.js` las siguientes l√≠neas:

```javascript
grunt.loadNpmTasks("grunt-contrib-watch");
grunt.loadNpmTasks("grunt-contrib-stylus");
grunt.loadNpmTasks("grunt-contrib-cssmin");
grunt.loadNpmTasks("grunt-bg-shell");
```

las tareas que vamos a definir ser√°n las siguientes:

```javascript
// Con √©sta tarea llamada 'compile' llamamos a las
// tareas 'stylus' y 'cssmin' que ahora definiremos
grunt.registerTask("compile", ["stylus", "cssmin"]);

// √â¬âsta tarea llamada 'server' nos permitir√° correr
// el servidor a al vez que las tareas 'compile' y
// 'watch' que ahora definiremos
grunt.registerTask("server", ["bgShell:runNode", "compile", "watch"]);
```

Procedemos a crear las tareas:

- `bgShell:runNode` con ella indicamos un comando para ejecutar por el inteerprete.
- `stylus`: Con ella preprocesamos los ficheros `.styl` que tengamos a un √∫nico fichero .css (Stylus es un preprocesador de CSS como lo son Compass, Sass, Less,‚Ä¶ pero m√°s hipster porque funciona bajo Node.js ;)
- `cssmin`: Con esto minificamos el fichero css resultante en una sola l√≠nea de texto para que sea menos pesado y nuestra aplicaci√≥n web tarde menos en cargar
- `watch`: Gracias a ella cualquier cambio que hagamos en un fichero CSS o STYLUS se dar√° cuenta y ejecutar√° el preprocesamiento para que no tengamos que preocuparnos de resetear nada.

El c√≥digo para definir las tareas ser√≠a algo as√≠:

```javascript
module.exports = function(grunt) {
	grunt.initConfig({
		pkg: grunt.file.readJSON('package.json'),

		bgShell: {
			runNode: {
				cmd: 'node app.js',
				bg: true
			}
		},

		stylus: {
			compile: {
				options: {
					paths: [stylesheetsDir],
					'include css': true
				},
				files: {
					'public/app/css/app.min.css': stylesheetsDir + '/index.styl'
				}
			}
		},

		watch: {
			stylesheets: {
				files: [stylesheetsDir + '/**/*.styl', stylesheetsDir + '/**/*.css'],
				tasks: ['stylus'],
				options: {
					interrupt: true
				}
			}
		}
	});
```

Para arrancar nuestra aplicacieon y hacer correr las tareas, en lugar de ejecutar `node app.js` por ejemplo, tendr√≠amos que ejecutar

```shell
grunt server
```

Puedes ver un ejemplo completo en el siguiente repositorio [grunt-node-sandbox](https://github.com/carlosazaustre/grunt-node-sandbox). Por supuesto se pueden automatizar m√°s cosas, como por ejemplo minificar el JavaScript, generar archivos preconfigurados de backbone, a√±adir etiquetas a nuestros archivos con la fecha, nombre de autor, etc.. Un mont√≥n de cosas que puedes ver por [aqu√≠](http://gruntjs.com/sample-gruntfile)
