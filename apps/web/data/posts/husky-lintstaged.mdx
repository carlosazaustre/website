---
title: "CÃ³mo configurar Husky y Lint-Staged en un proyecto"
date: "2022-11-09"
tags:
  - "ğŸ§‘ğŸ»â€ğŸ’» Desarrollo"
  - "ğŸ“¦ Git"
---

Mejora tu flujo de desarrollo como programador, utilizando Git Hooks que se ejecuten antes de un commit,
push, etc... y que comprueben si el Linter
pasa correctamente, los test dan OK,...
y asÃ­ asegures que el cÃ³digo que subes a
tu repositorio cumple un mÃ­nimo de calidad.

Para ello tenemos herramientas como Husky y
Lint-Staged que nos ayudan a configurarlo.

En este tutorial vemos como hacerlo, pero si quieres verlo en video, aquÃ­ abajo te lo dejo en YouTube.

<YouTube videoId="YWBrzwSDpo8" />

## Iniciando proyecto de ejemplo

Usaremos node y npm para este ejemplo, pero puedes usar cualquier otro lenguaje y gestor de paquetes.

```bash
mkdir husky-lint-staged
cd husky-lint-staged
npm init -y
```

Ahora iniciamos un nuevo repositorio, ya que [Husky](https://typicode.github.io/husky/#/) utiliza [Git Hooks](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks).
Si no tienes un repositorio, no vas a poder instalar Husky.

```bash
git init
```

Instalamos las depencencias de desarrollo que vamos a usar.

```bash
npm i -D husky lint-staged
```

## Â¿Por quÃ© usar Husky y Lint-Staged?

Husky en lo que se basa es en los [Git Hooks](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks),
que son scripts que se ejecutan en momentos determinados, como antes de un commit, push, etc...

Por ejemplo el script de `pre-commit` nos permite que antes de finalizar un commit, se ejecute un script que corra el Linter
y nos diga si hay errores o no y asegurarnos que el cÃ³digo que se sube al repositorio sigue las reglas de estilo.

Por otro lado, Lint-Staged nos permite ejecutar scripts en los archivos que se van a subir al repositorio, es decir,
solo en los archivos que hemos modificado, no en todos los archivos del proyecto. Se entiende que el resto de archivos que no
hemos tocado ya estÃ¡n bien y no necesitan ser revisados.

## Configurando Husky y Lint-staged

Creamos un fichero `.lintstagedrc` en la raÃ­z de nuestro proyecto, con el siguiente contenido:

```json
{
  "*.{js,jsx,ts,tsx}": ["eslint --fix", "git add"]
}
```

Aqui le estamos diciendo que para los ficheros con extensiÃ³n `js`, `jsx`, `ts` y `tsx`, ejecute el comando `eslint --fix` y
despuÃ©s aÃ±ada los cambios al commit.

Ahora en nuestro `package.json` aÃ±adimos un script que podemos llamar `prepare`. Puedes aÃ±adirlo en la secciÃ³n `scripts` o
ejecutar el siguiente comando:

```bash
npm set-script prepare "husky install"
```

Esto nos permite configurar Husky de una forma mÃ¡s rÃ¡pida corriendo:

```bash
npm run prepare
```

Esto instala los git hooks dentro de la carpeta `.husky` que se acaba de crear.

## AÃ±adir el pre-commit hook

Ahora vamos a aÃ±adir el pre-commit hook, para que antes de hacer un commit, se ejecute el script de Lint-Staged. Esto lo hacemos
con el siguiente comando:

```bash
npx husky add .husky/pre-commit "npx lint-staged"
```

Esto crea el fichero `.husky/pre-commit` con el siguiente contenido:

```bash
#!/usr/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged
```

## Configurar el Linter

Tenemos el hook pero no tenemos un linter configurado. Solucionemos eso. Ejecutamos el siguiente comando para que se instale
y configure ESlint de una forma rÃ¡pida:

```bash
npx eslint --init
```

Elige las opciones de configuraciÃ³n que prefieras.

Ahora si realizas un commit y modificas un fichero con extensiÃ³n `js`, `jsx`, `ts` o `tsx`, se ejecutarÃ¡ el script de Lint-Staged
y se ejecutarÃ¡ el comando `eslint --fix` y se aÃ±adirÃ¡n los cambios al commit.

## AÃ±adir el pre-push hook

Ahora vamos a aÃ±adir el pre-push hook, para que antes de hacer un push, se ejecuten los scripts que determinemos, como por ejemplo que
se lancen los Tests y sÃ³lo si pasan, el cÃ³digo se suba finalmente al repositorio.Esto lo hacemos
con el siguiente comando:

```bash
npx husky add .husky/pre-push "npm run test"
```

Si no tienes tests o estos no pasan, el push no se realizarÃ¡ hasta que lo soluciones.

Para que puedas probar este ejemplo, vamos a crear un fichero y un pequeÃ±o test, ademÃ¡s de la configuraciÃ³n de ESLint necesaria para que no
te de errores:

Primero de todo, instalarÃ© Jest como runner de tests:

```bash
npm i -D jest
```

Seguidamente, para no complicarnos mucho con este ejemplo, en un fichero `.eslintignore` vamos a aÃ±adir la carpeta de `tests` y ya que estamos
tambiÃ©n `node_modules` por curarnos en salud.

```json
//.eslintignore
node_modules
__test__
```

Tendremos un fichero de ejemplo, `index.js` que simplemente exporta una funciÃ³n que devuelve la suma de dos valores:

```js
// index.js
const sum = (a, b) => a + b;

module.exports = { sum };
```

Y en la carpeta `__test__` tendremos un fichero `index.test.js` que importarÃ¡ la funciÃ³n `sum` y harÃ¡ un test para comprobar que
funciona correctamente:

```js
// index.test.js
const { sum } = require("./index");

test("adds 1 + 2 to equal 3", () => {
  expect(sum(1, 2)).toBe(3);
});
```

Puedes jugar con esto para ver como el test falla y no te deja realizar el push.

## ConclusiÃ³n

Esto es solo una de las muchas cosas que podemos hacer con Husky y Lint-Staged. Puedes ver mÃ¡s en la [documentaciÃ³n de Husky](https://typicode.github.io/husky/#/).

En un prÃ³ximo artÃ­culo tutorial, veremos como configurar todo esto para que el propio mensaje de commit siga unas normas de estilo, conocidas
como 'Conventional Commits'.

**DÃ©jame en los comentarios si te interesa.**

```

```
