---
title: "3 formas de comunicar componentes en AngularJS 1.x"
date: "2016-01-27"
tags:
  - "游눹 Desarrollo"
---

> Este es un post invitado escrito por <a href="https://twitter.com/erixdev">Emilio Grande</a>, autor del blog <a href="https://jsjutsu.com/blog/">JSJutsu</a> el cu치l te invito a leer.

Emilio hace un buen resumen sobre las 3 principales maneras que existen en AngularJS 1.x para comunicar componentes (o directivas hasta la versi칩n 1.4).

## Introducci칩n

Dentro de las necesidades m치s habituales en una aplicaci칩n [AngularJS](https://angularjs.org/) est치 la de **comunicar diferentes componentes**.

En AngularJS podemos hacer esto de diferentes formas, y conviene conocerlas para saber cu치l aplicar en cada caso.

**Una buena aplicaci칩n JavaScript est치 [dividida en componentes](/angular-js-directivas-como-componentes/)** y es importante saber c칩mo relacionarlos de la forma m치s limpia posible.

Vamos a ver c칩mo comunicar los componentes rojo y azul del siguiente ejemplo:

```html
<div ng-app="myApp">
  <div class="controllerOne" ng-controller="controllerOne as c1">
    <!-- Componente Rojo -->
    <div class="controllerTwo" ng-controller="controllerTwo as c2">
      <input type="text" />
      <button>Send Event</button>
    </div>
    <!-- /Componente Rojo -->

    <!-- Componente Azul -->
    <div class="controllerThree" ng-controller="controllerThree as c3">
      <div>Nothing here...</div>
    </div>
    <!-- /Componente Azul -->
  </div>
</div>
```

![Aplicaci칩n Base](/images/formas-de-comunicar-componentes-en-angularjs-1-x/comm_ang_ejemploBase.png)

En este caso los componentes est치n encapsulados en _controladores_, pero podr칤an ser directivas perfectamente.

## Forma 1: a trav칠s del _scope_

La **forma m치s sencilla** y m치s utilizada para comunicar componentes **es usando el _scope_**.

Consiste en utilizar el **_scope_ com칰n a los componentes m치s pr칩ximo**.

En AngularJS 1x, cada componente tiene su propio _scope_. El _scope_ **hereda en forma de 치rbol desde el _scope_ ra칤z de la aplicaci칩n, que es _$rootScope_**.

En concreto, en este ejemplo es as칤:

![Herencia $scope](/images/formas-de-comunicar-componentes-en-angularjs-1-x/comm_ang_herenciaScope.png)

Por tanto, en este caso podemos comunicar C2 (Rojo) y C3 (Azul), a trav칠s del componente C1. Veamos c칩mo:

```html
<div ng-app="myApp">
  <div class="controllerOne" ng-controller="controllerOne as c1">
    <!-- Componente Rojo -->
    <div class="controllerTwo" ng-controller="controllerTwo as c2">
      <input type="text" ng-model="c1.message" />
      <button ng-click="c1.sendEvent()">Send Event</button>
    </div>
    <!-- /Componente Rojo -->

    <!-- Componente Azul -->
    <div class="controllerThree" ng-controller="controllerThree as c3">
      <div>{{ c1.data }}</div>
    </div>
    <!-- /Componente Azul -->
  </div>
</div>
```

```javascript
controller("controllerOne", function () {
  var vm = this;
  vm.data = "Nothing here...";
  vm.sendEvent = function () {
    vm.data = vm.message;
  };
});
```

Lo que hemos hecho aqu칤 es simplemente utilizar el _scope_ del componente padre (C1), al que tienen acceso los componentes hijos (C2 y C3).

![Comunicando con $scope](https://carlosazaustre.es/blog/content/images/2016/01/comm_ang_forma1.png)

### Ventajas e inconvenientes

Usar el _scope_ es **lo m치s simple y lo que menos c칩digo requiere**.

El problema es que en una **aplicaci칩n grande los _scopes_ compartidos pueden r치pidamente volverse inmanejables y establecer un grado de acoplamiento muy alto**, lo cual no es deseable.

## Forma 2: a trav칠s de eventos

AngularJS 1.x proporciona un [sistema de eventos](https://docs.angularjs.org/api/ng/type/$rootScope.Scope#$on) muy 칰til al que se accede mediante los **m칠todos _$broadcast_, _$on_ y _$emit_**.

Lo que haremos aqu칤 es: **emitir eventos hacia abajo en el 치rbol** con _$broadcast_.

Veamos c칩mo.

```html
<div ng-app="myApp">
  <div class="controllerOne" ng-controller="controllerOne as c1">
    <!-- Componente Rojo -->
    <div class="controllerTwo" ng-controller="controllerTwo as c2">
      <input type="text" ng-model="c2.message" />
      <button ng-click="c2.sendEvent()">Send Event</button>
    </div>
    <!-- /Componente Rojo -->

    <!-- Componente Azul -->
    <div class="controllerThree" ng-controller="controllerThree as c3">
      <div>{{ c3.data }}</div>
    </div>
    <!-- /Componente Azul -->
  </div>
</div>
```

```javascript
.controller('controllerTwo', function($scope){
  var vm = this;
  vm.sendEvent = function() {
    $scope.$parent.$broadcast('msg', vm.message);
  };
})
.controller('controllerThree', function($scope){
  var vm = this;
  vm.data = 'Nothing here...';
  $scope.$on('msg', function(evt, msg){
    vm.data = msg;
  });
});

```

En este caso el componente C2 emite un evento de tipo 'msg', a trav칠s del componente C1. El componente C3 est치 escuchando los eventos 'msg', y al recibirlos ejecuta su funci칩n de _callback_.

![Comunicando con eventos](/images/formas-de-comunicar-componentes-en-angularjs-1-x/comm_ang_forma2.png)

### Ventajas e inconvenientes

Los eventos son 칰tiles para **comunicar eventos espec칤ficos de componentes padres a hijos**.

En caso de tener que comunicar componentes a otro nivel y tener que recurrir a emit o scopes padres (como en el ejemplo), o incluso al $rootScope, una vez m치s en una aplicaci칩n grande podemos tener eventos que circulen por toda la aplicaci칩n. Esto no nos interesa.

## Forma 3: a trav칠s de un servicio

La forma m치s elaborada de comunicar componentes, y a la vez la m치s mantenible, es mediante **servicios intermedios requeridos por ambos componentes**.

Veamos el ejemplo.

```html
<div ng-app="myApp">
  <div class="controllerOne" ng-controller="controllerOne as c1">
    <!-- Componente Rojo -->
    <div class="controllerTwo" ng-controller="controllerTwo as c2">
      <input type="text" ng-model="c2.message" />
      <button ng-click="c2.sendEvent()">Send Event</button>
    </div>
    !-- /Componente Rojo --> !-- Componente Azul -->
    <div class="controllerThree" ng-controller="controllerThree as c3">
      <div>{{ c3.data() }}</div>
    </div>
    !-- /Componente Azul -->
  </div>
</div>
```

```javascript
.factory('utilityService', function() {
  return {
    message: 'Nothing here...',
    getMessage: function() {
      return this.message;
    },
    setMessage: function(msg) {
      this.message = msg;
    }
  };
})

.controller('controllerTwo', function(utilityService){
  var vm = this;
  vm.sendEvent = function() {
    utilityService.setMessage(vm.message);
  };
})

.controller('controllerThree', function(utilityService){
  var vm = this;
  vm.data = function(){
    return utilityService.getMessage();
  }
});

```

Con esta 칰ltima forma, hemos creado un **servicio que inyectamos en ambos componentes**, y es el que se encarga de gestionar la informaci칩n a compartir.

![Comunicando con servicios](/images/formas-de-comunicar-componentes-en-angularjs-1-x/comm_ang_forma3.png)

### Ventajas e inconvenientes

Los **servicios son la mejor manera de comunicar las diferentes piezas de nuestro puzzle** y pueden ser requeridos en cualquier sitio que se precise de la aplicaci칩n.

La desventaja, que requieren de m치s c칩digo para prepararlos y en situaciones simples puede ser _"matar moscas a ca침onazos"_.

## Conclusi칩n

AngularJS es muy flexible y nos permite compartir y comunicar las diferentes piezas de nuestra aplicaci칩n de forma organizada y controlable.

Como sabes por 칠ste blog, [Angular 2 y sus componentes](/angular-2-rutas-y-componentes/) cambian la forma de trabajar totalmente, pero la idea es la misma: partir la aplicaci칩n en componentes.

Adem치s a Angular 1 todav칤a le queda mucho recorrido por delante :)
