---
title: "CÃ³mo instalar un Servidor HTTPS en Nginx desde cero"
date: "2014-06-16"
tags:
  - "ðŸ’» Desarrollo"
---

Cuando en nuestra web o aplicaciÃ³n necesitamos tratar con datos sensibles como pueden ser tarjetas de crÃ©dito, cuentas de usuario, etc, **es recomendable disponer de un certificado SSL** en nuestro servidor para utilizar el protocolo HTTPS (Http Seguro) en lugar del HTTP normal. De esta manera, nuestros datos viajan encriptados en la aplicaciÃ³n y es mas difÃ­cil que sean â€œescuchadosâ€ por otros.

![nginx https ssl](/images/como-instalar-un-servidor-https-en-nginx-desde-cero/Screen-Shot-2014-07-15-at-18_39_52_xjqlkp.png)

Para el proyecto que estamos llevando a cabo mi compaÃ±era [Paola](http://twitter.com/ggarciapaola) y yo, **[Chefly](https://chefly.co "Encuentra gente que cocine para tÃ­")** (Del que pronto empezarÃ©is a oir) necesitamos disponer de HTTPS y tras pelearme un rato con su configuraciÃ³n conseguÃ­ ponerlo en marcha. Este tutorial espero que os ayude y os ahorre tiempo a la hora de implementarlo en vuestros servidores.

En nuestro caso, nuestro servidor es una instancia **EC2 en Amazon Web Services** con **Ubuntu 14.04 LTS**, y como servidor web/proxy utilizamos **Nginx**.

Lo primero que necesitamos es **crear una clave privada** en nuestro servidor:

```shell
$ cd /etc/ssl/
$ sudo openssl genrsa -des3 -out server.key 2048
```

Con nuestra clave privada generada, creamos un **Certificate Signing Request (CSR)** para solicitar nuestro certificado SSL a una entidad de autorizaciÃ³n reconocida, en nuestro caso optamos por [RapidSSL](http://www.rapidssl.com/).

```shell
$ sudo openssl req -new -key server.key -out server.csr
```

Este proceso nos pedirÃ¡ una serie de datos que son importantes para solicitar el certificado SSL:

- **Country Name (C):** Un cÃ³digo de dos letras para determinar el paÃ­s, en nuestro caso ponemos US ya que la entidad que lo va a manejar (RapidSSL) es de Estados Unidos.
- **State or Province (S):**Â Estado o provincia, este campo puede quedar vacÃ­o
- **Locality or City (L):**Â Localidad o ciudad, tambiÃƒÂ©n se puede dejar vacio.
- **Organization (O):**Â Nombre de la organizaciÃ³n que maneja tu certificado SSL, en nuestro caso RapidSSL opera a travÃ©s de GeoTrust, Inc. y ponemos ese nombre.
- **Common Name (CN):** Nuestro nombre de dominio, `tudominio.com`. sin las www delante.

Esto nos generarÃ¡ un archivo `CSR` que debemos subir a RapidSSL cuando solicitemos y compremos un certificado SSL. Una vez comprado, RapidSSL nos enviarÃ¡ a nuestro email el certificado, que deberemos copiar y pegar en un fichero de texto con el nombre `SSL.crt` para seguir la nomenclatura de Nginx.

Desde la pÃ¡gina de RapidSSL necesitamos tambiÃ©n descargarnos un [certificado intermedio](https://knowledge.rapidssl.com/support/ssl-certificate-support/index?page=content&id=AR1549), lo guardamos como `intermediate.crt` yÂ debemos concatenar al anterior

```shell
$ sudo cat SSL.crt intermediate.crt >> SSL.crt
```

Con esto ya tenemos lo necesario para que nuestro servidor web, acepte HTTPS, solo tenemos que **configurar Nginx para que escuche en el puerto 443** (el de HTTPS) indicÃ¡ndole los ficheros.

Editamos el fichero default de configuraciÃ³n con lo siguiente:

```shell
$ sudo nano /etc/nginx/sites-available/default
```

```shell
server {
  listen 443;
  server_name tudominio.com;

  root /usr/share/nginx/html; # Directorio donde estÃ¡n nuestros archivos estÃ¡ticos
  index index.html index.htm

  ssl on;
  ssl_certificate /etc/ssl/SSL.crt
  ssl_certificate_key /etc/ssl/server.key

  access_log /var/log/nginx/nginx.vhost.access.log
  error_log /var/log/nginx/nginx.vhost.error.log
```

Reiniciamos nginx y nos aseguramos que en nuestro DNS, `tudominio.com` apunta a la IP o alias de nuestro servidor

```shell
sudo service nginx restart
```

Con todo esto si accedemos a `https://tudominio.com` funcionarÃ¡, pero Â¿Y si entramos desde `http://tudominio.com`? No nos redirije al HTTPS, Â¿Y si escribimos `www.tudominio.com`? aunque lo tengamos definido en nuestro DNS, no nos redirije al HTTPS. Â¿CÃ³mo arreglamos esto? AÃ±adiendo mÃ¡s reglas a nuestro archivo de configuraciÃ³n de Nginx:

```shell
# Redirige de http://tudominio.com a https://tudominio.com
server {
        listen 80;
        return 301 https://$host$request_uri;
}

# Redirige de http://www.tudominio.com a https://tudominio.com
server {
        listen 80;
        server_name www.tudominio.com;
        return 301 https://tudominio.com$request_uri;
}

# Redirige de https://www.tudominio.com a https://tudominio.com
server {
        listen 443;
        server_name www.tudominio.com;
        return 301 $scheme://tudominio.com$request_uri;
```

Con esto ya tendremos todas las opciones cubiertas y podremos hacer uso del protocolo seguro de HTTP en nuestro servidor.

**Fuentes:**

- [http://www.digitalvalley.com/blog/como-crear-un-certificado-ssl-en-nginx-para-ubuntu/](http://www.digitalvalley.com/blog/como-crear-un-certificado-ssl-en-nginx-para-ubuntu/)
- [http://www.digicert.com/ssl-certificate-installation-nginx.htm](http://www.digicert.com/ssl-certificate-installation-nginx.htm)
- [https://knowledge.rapidssl.com/support/ssl-certificate-support/index?page=content&actp=CROSSLINK&id=SO17664](https://knowledge.rapidssl.com/support/ssl-certificate-support/index?page=content&actp=CROSSLINK&id=SO17664)
