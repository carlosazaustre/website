---
title: "Tutorial de AngularJS. Ejemplo de aplicaci√≥n web conectada a una API REST con Node"
date: "2014-01-13"
tags:
  - "üíª Desarrollo"
---

[AngularJS](/empezando-con-angular-js) es uno de los frameworks m√°s populares para desarrollar aplicaciones del lado cliente (Frontend) con JavaScript.

√âste tutorial, [basado en √©ste otro de Scotch.io](https://scotch.io/tutorials/javascript/creating-a-single-page-todo-app-with-node-and-angular) nos sirve para empezar a desarrollar profesionalmente con AngularJS.

Vamos a ver como crear una [_Single Page Application_](https://en.wikipedia.org/wiki/Single-page_application), y como conectarla a una [API REST construida con NodeJS](/como-crear-una-api-rest-usando-node-js/) y Mongo como base de datos. Completando as√≠ el Stack tecnol√≥gico conocido como, [MEAN](http://mean.io).

### Arquitectura de la aplicaci√≥n web SPA + API REST

Y antes de seguir con el c√≥digo, veamos un diagrama visual del flujo que va a seguir aplicaci√≥n con las tecnolog√≠as que empleamos en cada parte:

![Esquema arquitectura de apliaci√≥n web con AngularJS y NodeJS](/images/tutorial-ejemplo-de-aplicacion-web-con-angular-js-y-api-rest-con-node/tutorial-angular-node-esquema-arquitectura-aplicacion-web.png)

Desde el frontend, con Angular hacemos llamadas AJAX a nuestra API en el servidor Node. Este consulta a la base de datos (Mongo) dependiendo de la llamada realizada. La BD devuelve el objeto como respuesta a Node y este lo sirve como JSON a Angular que lo muestra en el frontend sin necesidad de recargar la p√°gina, creando as√≠ una _Single Page Application_.

### Estructura de archivos

La estructura de archivos va a ser muy sencilla, no vamos a modularizar ni a√±adir [tareas con Grunt](/automatizar-tareas-en-javascript-con-grunt-js/) para enfocarnos en los conceptos de Angular. Estos son los ficheros que tendremos

```javascript
- public
----- index.html
----- main.js
server.js
package.json
```

- `main.js` contendr√° toda la l√≥gica del frontend, es donde tendremos los controladores de Angular JS y llamaremos via AJAX al API para pedir contenido, borrarlo, etc..
- `index.html` ser√° nuestro √∫nico fichero html y por tanto nuestra √∫nica p√°gina, toda la funcionalidad ser√° en ella.
- `server.js` es nuestro fichero Node donde estar√° la configuraci√≥n del servidor y las rutas a nuestro API.
- `package.json` es el fichero donde est√°n los datos de la aplicaci√≥n y las dependencias utlizadas, como toda aplicaci√≥n Node.

Empezaremos por **package.json** para indicar que dependencias vamos a necesitar, que simplemente ser√°n _Express_ y _Mongoose_:

```javascript
{
	"name": "angular-todo",
	"version": "0.0.1",
	"description": "Simple Angular TODO app based in MEAN stack",
	"main": "server.js",
	"dependencies": {
		"express": "~3.x",
		"mongoose": "latest"
	}
```

Despu√©s de esto, en una terminal ejecutamos `npm install` y se nos instalar√°n las dependencias para poder empezar a utilizarlas.

### Implementando nuestro API REST

Ahora pasaremos al archivo **server.js** que ser√° el fichero donde est√© la configuraci√≥n del servidor, as√≠ como la conexi√≥n a la base de datos y las rutas de nuestro API.

En los comentarios del c√≥digo he explicado a grandes rasgos que hace cada l√≠nea.

Como todo fichero de servidor de Node, primero a√±adimos las librer√≠as que necesitamos (express y mongoose).

```javascript
//server.js

var express = require("express");
var app = express();
var mongoose = require("mongoose");

// Conexi√≥n con la base de datos
mongoose.connect("mongodb://localhost:27017/angular-todo");

// Configuraci√≥n
app.configure(function () {
  // Localizaci√≥n de los ficheros est√É¬°ticos
  app.use(express.static(__dirname + "/public"));
  // Muestra un log de todos los request en la consola
  app.use(express.logger("dev"));
  // Permite cambiar el HTML con el m√©todo POST
  app.use(express.bodyParser());
  // Simula DELETE y PUT
  app.use(express.methodOverride());
});

// Escucha en el puerto 8080 y corre el server
app.listen(8080, function () {
  console.log("App listening on port 8080");
});
```

#### Creaci√≥n del modelo de datos

El siguiente paso es construir el modelo de la base de datos que modele las tareas o ‚ÄúToDos‚Äù. Esto lo hacemos con _Mongoose_ y nuestro modelo ser√° muy sencillo ya que solo cuenta con un atributo ‚ÄúText‚Äù que define la tarea. Este c√≥digo lo insertamos en **server.js** antes de la l√≠nea donde se inicia el servidor con `app.listen`

```javascript
// Definici√≥n de modelos
var Todo = mongoose.model("Todo", {
  text: String,
});
```

#### Definici√≥n de rutas o _Endpoints_ del API

Tras esto nos queda construir las rutas que llamar√°n a nuestro API y que utilizaremos desde el frontend. En esta tabla se muestran las 3 llamadas que vamos a implementar y que definir√°n nuestra API:

| HTTP   | URL                | Descripci√≥n                        |
| ------ | ------------------ | ---------------------------------- |
| GET    | `/api/todos`       | Devuelve todas las tareas de la BD |
| POST   | `/api/todos`       | Crea una tarea                     |
| DELETE | `/api/todos/:todo` | Borra una tarea                    |

Veamos las rutas. Estas ir√°n tambi√©n en el archivo `server.js`, justo antes de cuando se inicia el servidor y escucha en el puerto con `app.listen`

```javascript
// Rutas de nuestro API
// GET de todos los TODOs
app.get("/api/todos", function (req, res) {
  Todo.find(function (err, todos) {
    if (err) {
      res.send(err);
    }
    res.json(todos);
  });
});

// POST que crea un TODO y devuelve todos tras la creaci√≥n
app.post("/api/todos", function (req, res) {
  Todo.create(
    {
      text: req.body.text,
      done: false,
    },
    function (err, todo) {
      if (err) {
        res.send(err);
      }

      Todo.find(function (err, todos) {
        if (err) {
          res.send(err);
        }
        res.json(todos);
      });
    }
  );
});

// DELETE un TODO espec√≠fico y devuelve todos tras borrarlo.
app.delete("/api/todos/:todo", function (req, res) {
  Todo.remove(
    {
      _id: req.params.todo,
    },
    function (err, todo) {
      if (err) {
        res.send(err);
      }

      Todo.find(function (err, todos) {
        if (err) {
          res.send(err);
        }
        res.json(todos);
      });
    }
  );
});

// Carga una vista HTML simple donde ir√° nuestra Single App Page
// Angular Manejar√° el Frontend
app.get("*", function (req, res) {
  res.sendfile("./public/index.html");
});
```

Gracias a Mongoose podemos buscar(**find**), borrar (**remove**) y crear(**create**) de una manera muy sencilla. La √∫ltima ruta no corresponde al API, si no que ser√° la encargada de mostrar el html donde ejecutaremos toda la l√≥gica del Frontend.

### Desarrollo de la parte Frontend con AngularJS

Todo lo que hemos hecho hasta ahora corresponde al Backend de la aplicaci√≥n. Ahora empezaremos con lo que de verdad importa, el desarrollo frontend con Angular.

Tendremos toda la l√≥gica en el fichero **main.js**, primero crearemos un modulo que ser√° el que defina toda nuestra aplicaci√≥n

```javascript
angular.module("angularTodo", []);
```

y seguidamente la funci√≥n `mainController` que ser√° el controlador de la aplicaci√≥n

```javascript
function mainController($scope, $http) {
  $scope.formData = {};

  // Cuando se cargue la p√°gina, pide del API todos los TODOs
  $http
    .get("/api/todos")
    .success(function (data) {
      $scope.todos = data;
      console.log(data);
    })
    .error(function (data) {
      console.log("Error: " + data);
    });

  // Cuando se a√±ade un nuevo TODO, manda el texto a la API
  $scope.createTodo = function () {
    $http
      .post("/api/todos", $scope.formData)
      .success(function (data) {
        $scope.formData = {};
        $scope.todos = data;
        console.log(data);
      })
      .error(function (data) {
        console.log("Error:" + data);
      });
  };

  // Borra un TODO despues de checkearlo como acabado
  $scope.deleteTodo = function (id) {
    $http
      .delete("/api/todos/" + id)
      .success(function (data) {
        $scope.todos = data;
        console.log(data);
      })
      .error(function (data) {
        console.log("Error:" + data);
      });
  };
}
```

Pasemos a explicar algunos conceptos de esta parte.

En el objeto `$scope` se almacenan todas las variables dentro del √°mbito del controlador. En el HTML, todo lo que se encuentre dentro de la directiva `ng-controller=‚ÄùmainController` es controlable desde el objeto `$scope`.

Y el objeto `$http` es el que hace toda la magia, ya que nos permite hacer llamadas AJAX a nuestro API con pocas l√≠neas de c√≥digo.

Con estos dos objetos creamos las 3 funciones que hacen las 3 peticiones que acepta nuestra API, el **GET** de todas las tareas almacenadas, el **POST** de creaci√É¬≥n de una nueva tarea y el **DELETE** de una tarea.

Y por √∫ltimo nos queda el **HTML** en el que maquetaremos los resultados que nos trae el API.

Necesitamos indicar que parte de la p√°gina corresponde a la aplicaci√≥n Angular, eso lo hacemos con la directiva `ng-app`. En nuestro caso lo hemos puesto en el tag `<html>` ya que todo el HTML, es la aplicaci√≥n.

```javascript
<html lang="en" ng-app="angularTodo">...
```

Una aplicaci√≥n Angular puede tener varios controladores, en este ejemplo solo tenemos uno, el `mainController`, y debemos decir en el HTML que parte es la corresponde a esta funci√≥n, eso lo hacemos con la directiva `ng-controller`. En nuestro caso la hemos puesto en el body porque no hay m√°s. Si tuviesemos m√°s controladores, se pueden poner en otros `section`, `article` o `div` y tener varios en la p√°gina.

```javascript
<body ng-controller="mainController">...
```

Para mostrar la lista de tareas que devuelve el `GET`, utilizaremos la directiva `ng-repeat` que nos permite crear una iteraci√≥n al estilo de un `for`

```javascript
<div class="checkbox" ng-repeat="todo in todos">
	<label>
    	<input type="checkbox" ng-click="deleteTodo(todo._id)"> {{ todo.text }}
	</label>
</div>
```

Con esto creamos un input de tipo checkbox por cada objeto que nos devuelve la llamada al API. Y con la directiva `ng-click` creamos un evento que escucha cuando marquemos el checkbox para llamar a la funci√≥n deleteTodo() a la cual se le pasa como par√°metro el id de la tarea para que llame al DELETE del API.

Por √∫ltimo, tenemos un formulario con un input de tipo texto donde escribimos tareas nuevas y las mandamos por POST al API. Aqu√≠ usamos una nueva directiva, `ng-model`, que es la que controla el Modelo en este caso la tarea y su texto, y de nuevo `ng-click` en el bot√≥n de submit para llamar a la funci√≥n `createTodo()` del controlador que hace el `POST` al API y a la Base de datos.

```javascript
<form>
	<div class="form-group">
		<input type="text" class="form-control input-lg text-center" placeholder="Inserta una tarea nueva" ng-model="formData.text">
	</div>
	<button class="btn btn-primary btn-lg" ng-click="createTodo()">
		A√±adir
	</button>
</form>
```

Con esto estar√≠a todo. Solo nos queda incluir las librer√≠as de `jQuery` y `Angular` como scripts al final de la p√°gina y y tambi√©n una hoja de estilos para que no sea tan fea la aplicaci√≥n. Hemos usado un [CDN](http://cdnjs.com/) para ello y as√≠ no tenemos que preocuparnos en bajarnos la librer√≠a y a√±adirla al proyecto, para centrarnos en entender los conceptos

El c√≥digo HTML completo ser√≠a as√≠:

```javascript
<!doctype html>
<html lang="en" ng-app="angularTodo">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Angular TODO app</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
</head>
<body ng-controller="mainController">
	<div class="container">
    <!--Cabecera-->
    	<div class="jumbotron text-center">
        	<h1>Angular TODO List <span class="label label-info">{{ todos.length }}</span></h1>
        </div>
        <!--Lista de Todos-->
        <div id="todo-list" class="row">
        	<div class="col-sm-4 col-sm-offset-4">
            	<div class="checkbox" ng-repeat="todo in todos">
                	<label>
                    	<input type="checkbox" ng-click="deleteTodo(todo._id)"> {{ todo.text }}
                    </label>
                 </div>
             </div>
         </div>
         <!--Formulario para insertar nuevos Todo--> 			<div id="todo-form" class="row">
        	<div class="col-sm-8 col-sm-offset-2 text-center">
            	<form>
                	<div class="form-group">
                    	<input type="text" class="form-control input-lg text-center" placeholder="Inserta una tarea nueva" ng-model="formData.text">
                    </div>
                    <button class="btn btn-primary btn-lg" ng-click="createTodo()">A√±adir</button>
                </form>
            </div>
        </div>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script> <script src="main.js"></script>
</body>
</html>
```

Y ya tenemos nuestra aplicaci√≥n de _ToDos_. Solo tenemos que correr el servidor en un terminal con node server.js e ir a un navegador a la URL http://localhost:8080 y tendremos algo como esto

![Ejemplo de Aplicaci√≥n web on AngularJS y un API REST con NodeJS](/images/tutorial-ejemplo-de-aplicacion-web-con-angular-js-y-api-rest-con-node/tutorial-angularjs-node-ejemplo-aplicacion-web.png)

##### Referencias

**Puedes ver una versi√≥n en ingl√©s de este ejemplo en el Blog [Scotch.io](http://scotch.io/tutorials/javascript/creating-a-single-page-todo-app-with-node-and-angular), escrito por [Chris Sevilleja](https://twitter.com/sevilayha/).**
